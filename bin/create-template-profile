#!/bin/bash

set -xe

DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )
ID=$1
export IP=`${DIR}/ip-of-editor-instance $ID`
echo $IP

$DIR/ssh-to-host $ID -f 'sudo systemctl stop rstudio-server && \
  sudo tar czf /tmp/editor-home-directory.tar.gz -C /home/kinetic/ . && \
  sudo systemctl start rstudio-server && \
  sudo chmod a+rw /tmp/editor-home-directory.tar.gz'

export SCP=true

$DIR/ssh-to-host $ID /tmp/editor-home-directory.tar.gz /tmp

aws s3 cp /tmp/editor-home-directory.tar.gz s3://kinetic-workspaces-config/configs/editor-home-directory.tar.gz

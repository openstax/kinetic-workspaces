#!/bin/bash

set -e

DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )

TYPE=$1
ID=$2

[[ -z $IP ]] && IP=`${DIR}/ip-of-instance $TYPE $ID`
# ensure both ID and ENV were given

echo $IP

if [[ -z $IP ]]; then
  echo "No IP found for $TYPE $ID"
  exit 1
fi
IPS=( $IP )

if [[ ${#IPS[@]} -gt 1 ]]; then
    echo "More than server is running. ($IP) Exiting"
    exit 1
fi


OPTS="-o UserKnownHostsFile=/dev/null -o CheckHostIP=no -o LogLevel=ERROR -o StrictHostKeyChecking=no -i ${DIR}/../tmp/key.pem"

if [[ -n $SCP ]]; then
  scp $OPTS ubuntu@$IP:"${@:3}"
else
  ssh $OPTS ubuntu@$IP "${@:3}"
fi

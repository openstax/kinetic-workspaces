#!/usr/bin/env sh

set -e

env=${1:-staging}

# echo yes if env equals prod
if [ "$env" = "prod" ]; then
  env=""
else
  env="-${env}"
fi

LAMBDA=kinetic$env-workspaces-front-desk
ASSETS_BUCKET=kinetic$env-workspaces-assets

echo $ASSSETS_BUCKET

export AWS_PAGER="" # silence cli using "less" to display output

./bin/build

aws lambda update-function-code --function-name $LAMBDA --zip-file fileb://./lambda/bundled.zip

sleep 5

aws lambda publish-version --function-name $LAMBDA

s5cmd cp dist/assets/ s3://$ASSETS_BUCKET/assets/
s5cmd cp  -acl public-read error.html s3://$ASSETS_BUCKET/error.html
s5cmd cp  -acl public-read dist/index.html s3://$ASSETS_BUCKET/editor/index.html
